<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å…§éƒ¨ç ”ç©¶ç’°å¢ƒï½œç­–ç•¥åˆ†æç³»çµ±ï¼ˆåƒ…ä¾›ç ”ç©¶ï¼‰</title>
  <meta name="robots" content="noindex,nofollow" />

  <!-- âœ… å…§å®¹å®‰å…¨æ”¿ç­–ï¼ˆCSPï¼‰ï¼‹ ååµŒå…¥ -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self';
             script-src 'self' https://unpkg.com https://byhbmmnacezzgkwfkozs.supabase.co 'unsafe-inline';
             style-src 'self' 'unsafe-inline';
             img-src 'self' data: https://byhbmmnacezzgkwfkozs.supabase.co;
             connect-src 'self' https://byhbmmnacezzgkwfkozs.supabase.co https://unpkg.com;
             frame-ancestors 'none';
             base-uri 'none';
             form-action 'self'">

  <style>
    :root { --card-r:12px; }
    body{ font-family: Arial,"å¾®è»Ÿæ­£é»‘é«”",sans-serif; margin:20px; background:#f8f9fa; color:#333; -webkit-font-smoothing:antialiased }
    h1{ text-align:center; margin:0 0 6px 0; font-weight:800; letter-spacing:.5px }
    .subtitle{ text-align:center; color:#666; margin:0 0 18px 0; font-size:14px }
    hr{ border:none; border-top:1px solid #ddd; margin:20px auto; max-width:1100px }

    .section-title-red{ max-width:1100px; margin:10px auto 12px; font-size:20px; font-weight:800; color:#d32f2f; letter-spacing:.5px }
    .section-title-blue{ max-width:1100px; margin:10px auto 12px; font-size:20px; font-weight:800; color:#0d6efd; letter-spacing:.5px }
    .section-title-black{ max-width:1100px; margin:10px auto 12px; font-size:20px; font-weight:800; color:#111; letter-spacing:.5px }

    /* ğŸ‘‡ å››æ¬„ä½ˆå±€ */
    .strategy-grid{ display:grid; grid-template-columns:repeat(4,1fr); gap:20px; max-width:1100px; margin:0 auto 28px }
    .strategy-col{ display:flex; flex-direction:column; gap:12px }
    .subcat{ font-weight:700; font-size:16px; color:#c62828; margin:0 0 4px 0; text-align:center }
    .nav{ display:grid; grid-template-columns:repeat(3,1fr); gap:20px; max-width:1100px; margin:0 auto 28px }

    a.card{ display:block; background:#fff; padding:18px 16px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.08); text-decoration:none; color:inherit; transition:transform .15s, box-shadow .15s; border:1px solid #e5e7eb }
    a.card:hover{ transform:translateY(-4px); box-shadow:0 10px 22px rgba(0,0,0,.12) }
    .card-title{ font-weight:700; font-size:18px; margin:0 0 8px 0; text-align:center }
    .card-title.red{ color:#d32f2f } .card-title.blue{ color:#0d6efd } .card-title.gray{ color:#6c757d } .card-title.black{ color:#111 }
    .card-desc{ margin:0; color:#666; font-size:14px; line-height:1.5; text-align:left }
    .lines{ margin-top:2px }
    .line{ display:grid; grid-template-columns:1fr 1.8fr 1fr; align-items:center; margin:2px 0; font-size:12px; column-gap:6px }
    .label{ text-align:center; color:#111 }
    .range{ text-align:center; color:#999; font-size:10px; white-space:nowrap }
    .val{ text-align:center; font-weight:700 }
    .val.pos{ color:#d32f2f } .val.neg{ color:#10b981 } .val.neu{ color:#666 }
    .period{ margin-top:6px; color:#666; font-size:12px; text-align:center }
    .strategy-col .card-desc{ display:none }
    .tag{ display:inline-block; font-size:12px; background:#eef4ff; color:#0d6efd; border-radius:999px; padding:3px 8px; margin-left:8px; vertical-align:middle }

    /* Gate */
    .gate{ max-width:960px; margin:20px auto; background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.05); padding:16px }
    .muted{ color:#666; font-size:13px }
    .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
    .btn{ background:#0d6efd; color:#fff; border:0; border-radius:10px; padding:10px 14px; cursor:pointer }
    .btn.gray{ background:#6c757d }
    input[type="password"]{ width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:8px }
    .error{ color:#c62828; font-size:12px; margin-top:6px; display:none }
    .hidden{ display:none }

    /* é ‚ç«¯é™åˆ¶ Banner */
    .restrict{ position:sticky; top:-20px; margin:-20px -20px 12px -20px; padding:6px 10px; background:#111; color:#fff; text-align:center; font-size:12px; letter-spacing:.5px; z-index:9999 }

    /* â€œæ“‹æ–°æ‰‹â€ */
    html,body{ -webkit-user-select:none; -moz-user-select:none; user-select:none; -webkit-touch-callout:none }
    a,button,input{ -webkit-user-select:auto; user-select:auto }
    #shield{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(3,7,18,.96); color:#fff; z-index:2147483647; text-align:center; padding:24px }

    /* å…è²¬æ¨£å¼ */
    .disclaimer{ line-height:1.75; font-size:14px }
    .disclaimer h4{ margin:12px 0 6px; font-size:14px; font-weight:800; color:#111 }
    .disclaimer ul{ margin:6px 0 10px 18px; padding:0 }
    .disclaimer li{ margin:4px 0 }
  </style>
</head>
<body translate="no">
  <div class="restrict">RESTRICTED â€¢ INTERNAL RESEARCH ONLY â€¢ NOT FOR PUBLIC DISTRIBUTION â€¢ NON-ADVISORY</div>
  <div id="shield"><div><h3>é é¢å—ä¿è­·</h3>åµæ¸¬åˆ°å˜—è©¦æª¢è¦–åŸå§‹ç¢¼æˆ–é–‹ç™¼è€…å·¥å…·ï¼Œè«‹é—œé–‰å¾Œé‡æ–°æ•´ç†ã€‚</div></div>

  <!-- (A) å…è²¬ï¼‹å¯†ç¢¼é–€æª» -->
  <div id="gate" class="gate">
    <!-- â€¦â€¦å…è²¬æ¢æ¬¾ç•¥â€¦â€¦ -->
    <div class="row" style="margin-top:12px;max-width:420px">
      <input id="pwd" type="password" placeholder="å¯†ç¢¼ / Password" autocomplete="current-password" />
      <button class="btn" id="btnLogin">é€²å…¥ / Enter</button>
      <button class="btn gray" id="btnClear">æ¸…é™¤ / Clear</button>
      <div id="err" class="error">å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚/ Incorrect password.</div>
    </div>
  </div>

  <!-- (B) å…§å®¹ -->
  <div id="app" class="hidden">
    <h1>å…§éƒ¨ç ”ç©¶ç’°å¢ƒï½œç­–ç•¥åˆ†æç³»çµ±ï¼ˆåƒ…ä¾›ç ”ç©¶ï¼‰</h1>
    <p class="subtitle">åƒ…ä¾›ç ”ç©¶èˆ‡æ•™è‚²ç”¨é€”ã€€ï½œã€€éæŠ•è³‡å»ºè­°ã€€ï½œã€€åš´ç¦å°å¤–æ•£å¸ƒ</p>
    <hr>

    <h3 class="section-title-red">äº¤æ˜“ç­–ç•¥</h3>
    <div class="strategy-grid">
      <!-- 1) é †å‹¢å‹ -->
      <div class="strategy-col">
        <p class="subcat">é †å‹¢å‹</p>

        <a class="card" href="0807.html">
          <p class="card-title red">å°æŒ‡è¿‘-0807ç‰ˆæœ¬</p>
          <div class="lines">
            <p class="line"><span class="label">è¿‘1é€±å ±é…¬ç‡</span><span id="wk1-range-0807" class="range">â€”</span><span id="wk1-0807" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2é€±å ±é…¬ç‡</span><span id="wk2-range-0807" class="range">â€”</span><span id="wk2-0807" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1æœˆå ±é…¬ç‡</span><span id="m1-range-0807"  class="range">â€”</span><span id="m1-0807"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2æœˆå ±é…¬ç‡</span><span id="m2-range-0807"  class="range">â€”</span><span id="m2-0807"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3æœˆå ±é…¬ç‡</span><span id="m3-range-0807"  class="range">â€”</span><span id="m3-0807"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6æœˆå ±é…¬ç‡</span><span id="m6-range-0807"  class="range">â€”</span><span id="m6-0807"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1å¹´å ±é…¬ç‡</span><span id="y1-range-0807"  class="range">â€”</span><span id="y1-0807"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2å¹´å ±é…¬ç‡</span><span id="y2-range-0807"  class="range">â€”</span><span id="y2-0807"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3å¹´å ±é…¬ç‡</span><span id="y3-range-0807"  class="range">â€”</span><span id="y3-0807"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6å¹´å ±é…¬ç‡</span><span id="y6-range-0807"  class="range">â€”</span><span id="y6-0807"  class="val neu">â€”</span></p>
            <p class="period">æœŸé–“ï¼š<span id="period-0807">â€”</span></p>
          </div>
        </a>

        <a class="card" href="1001.html">
          <p class="card-title red">å°æŒ‡è¿‘-1001ç‰ˆæœ¬</p>
          <div class="lines">
            <p class="line"><span class="label">è¿‘1é€±å ±é…¬ç‡</span><span id="wk1-range-1001" class="range">â€”</span><span id="wk1-1001" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2é€±å ±é…¬ç‡</span><span id="wk2-range-1001" class="range">â€”</span><span id="wk2-1001" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1æœˆå ±é…¬ç‡</span><span id="m1-range-1001"  class="range">â€”</span><span id="m1-1001"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2æœˆå ±é…¬ç‡</span><span id="m2-range-1001"  class="range">â€”</span><span id="m2-1001"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3æœˆå ±é…¬ç‡</span><span id="m3-range-1001"  class="range">â€”</span><span id="m3-1001"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6æœˆå ±é…¬ç‡</span><span id="m6-range-1001"  class="range">â€”</span><span id="m6-1001"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1å¹´å ±é…¬ç‡</span><span id="y1-range-1001"  class="range">â€”</span><span id="y1-1001"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2å¹´å ±é…¬ç‡</span><span id="y2-range-1001"  class="range">â€”</span><span id="y2-1001"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3å¹´å ±é…¬ç‡</span><span id="y3-range-1001"  class="range">â€”</span><span id="y3-1001"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6å¹´å ±é…¬ç‡</span><span id="y6-range-1001"  class="range">â€”</span><span id="y6-1001"  class="val neu">â€”</span></p>
            <p class="period">æœŸé–“ï¼š<span id="period-1001">â€”</span></p>
          </div>
        </a>
      </div>

      <!-- 2) é€†å‹¢å‹ -->
      <div class="strategy-col">
        <p class="subcat">é€†å‹¢å‹</p>

        <a class="card" href="etf-00909.html">
          <p class="card-title red">00909-ETFç‰ˆæœ¬</p>
          <div class="lines">
            <p class="line"><span class="label">è¿‘1é€±å ±é…¬ç‡</span><span id="wk1-range-00909" class="range">â€”</span><span id="wk1-00909" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2é€±å ±é…¬ç‡</span><span id="wk2-range-00909" class="range">â€”</span><span id="wk2-00909" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1æœˆå ±é…¬ç‡</span><span id="m1-range-00909"  class="range">â€”</span><span id="m1-00909"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2æœˆå ±é…¬ç‡</span><span id="m2-range-00909"  class="range">â€”</span><span id="m2-00909"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3æœˆå ±é…¬ç‡</span><span id="m3-range-00909"  class="range">â€”</span><span id="m3-00909"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6æœˆå ±é…¬ç‡</span><span id="m6-range-00909"  class="range">â€”</span><span id="m6-00909"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1å¹´å ±é…¬ç‡</span><span id="y1-range-00909"  class="range">â€”</span><span id="y1-00909"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2å¹´å ±é…¬ç‡</span><span id="y2-range-00909"  class="range">â€”</span><span id="y2-00909"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3å¹´å ±é…¬ç‡</span><span id="y3-range-00909"  class="range">â€”</span><span id="y3-00909"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6å¹´å ±é…¬ç‡</span><span id="y6-range-00909"  class="range">â€”</span><span id="y6-00909"  class="val neu">â€”</span></p>
            <p class="period">æœŸé–“ï¼š<span id="period-00909">â€”</span></p>
          </div>
        </a>
      </div>

      <!-- 3) ç›¤æ•´å‹ï¼ˆç©ºï¼‰ -->
      <div class="strategy-col">
        <p class="subcat">ç›¤æ•´å‹</p>
      </div>

      <!-- 4) ç ”ç™¼ä¸­ï¼ˆ1031 ä¹Ÿé¡¯ç¤ºè¿‘æœŸå ±é…¬ï¼‰ -->
      <div class="strategy-col">
        <p class="subcat" style="color:#111">ç ”ç™¼ä¸­</p>
        <a class="card" href="tw-1031.html">
          <p class="card-title red">å°è‚¡-1031ç‰ˆæœ¬</p>
          <div class="lines">
            <p class="line"><span class="label">è¿‘1é€±å ±é…¬ç‡</span><span id="wk1-range-1031" class="range">â€”</span><span id="wk1-1031" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2é€±å ±é…¬ç‡</span><span id="wk2-range-1031" class="range">â€”</span><span id="wk2-1031" class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1æœˆå ±é…¬ç‡</span><span id="m1-range-1031"  class="range">â€”</span><span id="m1-1031"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2æœˆå ±é…¬ç‡</span><span id="m2-range-1031"  class="range">â€”</span><span id="m2-1031"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3æœˆå ±é…¬ç‡</span><span id="m3-range-1031"  class="range">â€”</span><span id="m3-1031"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6æœˆå ±é…¬ç‡</span><span id="m6-range-1031"  class="range">â€”</span><span id="m6-1031"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘1å¹´å ±é…¬ç‡</span><span id="y1-range-1031"  class="range">â€”</span><span id="y1-1031"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘2å¹´å ±é…¬ç‡</span><span id="y2-range-1031"  class="range">â€”</span><span id="y2-1031"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘3å¹´å ±é…¬ç‡</span><span id="y3-range-1031"  class="range">â€”</span><span id="y3-1031"  class="val neu">â€”</span></p>
            <p class="line"><span class="label">è¿‘6å¹´å ±é…¬ç‡</span><span id="y6-range-1031"  class="range">â€”</span><span id="y6-1031"  class="val neu">â€”</span></p>
            <p class="period">æœŸé–“ï¼š<span id="period-1031">â€”</span></p>
          </div>
        </a>
      </div>
    </div>

    <hr>

    <h3 class="section-title-blue">åˆ†æ</h3>
    <div class="nav">
      <a class="card" href="single.html"><p class="card-title blue">å–®æª”åˆ†æ</p><p class="card-desc">åˆ†æå–®ä¸€æª”æ¡ˆï¼Œè¼¸å‡ºæ”¶ç›Šæ›²ç·šã€KPIã€äº¤æ˜“çµ±è¨ˆèˆ‡é—œéµæŒ‡æ¨™ã€‚</p></a>
      <a class="card" href="multi.html"><p class="card-title blue">å¤šæª”åˆ†æ</p><p class="card-desc">åŒæ™‚ä¸Šå‚³å¤šå€‹æª”æ¡ˆï¼Œè¼¸å‡ºå½™ç¸½è¡¨ã€åˆ†ç­–ç•¥ï¼åˆ†å¹´åº¦çµ±è¨ˆèˆ‡æ¯”è¼ƒã€‚</p></a>
      <a class="card" href="monthly.html"><p class="card-title blue">åˆ†æœˆå ±å‘Š</p><p class="card-desc">è‡ªå‹•æŒ‰æœˆä»½æ‹†åˆ†ç¸¾æ•ˆï¼Œæä¾›æœˆåº¦ç›ˆè™§ã€å‹ç‡ã€PFã€MDD ç­‰å ±å‘Šã€‚</p></a>
      <a class="card" href="single-cloud.html"><p class="card-title blue">é›²ç«¯å–®æª”åˆ†æ <span class="tag">ç¬¬5åˆ†é </span></p><p class="card-desc">ç›´æ¥å¾ã€Œè³‡æ–™ä¸Šå‚³å€ã€æŒ‘é¸æª”æ¡ˆé€²è¡Œå–®æª”åˆ†æï¼Œå…é‡è¤‡ä¸Šå‚³ã€‚</p></a>
      <a class="card" href="multi-adv.html"><p class="card-title blue">å¤šæª”åˆ†æé€²éšç‰ˆ <span class="tag">ç¬¬6åˆ†é </span></p><p class="card-desc">é€²éšå½™ç¸½ï¼‹åƒæ•¸æ¬„ï¼›æ”¯æ´ä¸€éµé–‹å•Ÿå–®æª”åˆ†æï¼ˆæ©Ÿæ§‹ç´šï¼‰èˆ‡æŒ‡æ¨™å°ç…§ã€‚</p></a>
    </div>

    <hr>

    <h3 class="section-title-black">è³‡æ–™</h3>
    <div class="nav">
      <a class="card" href="upload.html">
        <p class="card-title black">ä¸Šå‚³æª”æ¡ˆ</p>
        <p class="card-desc">ä¸Šå‚³ï¼æª¢è¦–ï¼ä¸‹è¼‰ï¼åˆªé™¤å›æ¸¬èˆ‡å¯¦å€‰å ±è¡¨ï¼Œæ”¯æ´å¤šæª”æ‰¹æ¬¡è™•ç†ã€‚</p>
      </a>
    </div>
  </div>

  <!-- ===== JSï¼šå¯†ç¢¼é–€æª» + å‹•æ…‹è¼‰å…¥ + å ±é…¬å¡«å€¼ + å®‰æ§è£œå¼· + 1031 CSV è§£æ ===== -->
  <script>
  (function(){
    'use strict';

    // === å¯†ç¢¼é›œæ¹Šï¼ˆæ²¿ç”¨ï¼‰ ===
    const PASS_HASH = "0f2b9305e317408510dc9878381e953630ed9fa3d2aadf95f1b8eb47941b18b9";

    // === Key å¸¸æ•¸ ===
    const KEY_OK='__auth_ok__';
    const FAIL_KEY='__auth_fail__';
    const LOCK_UNTIL_KEY='__auth_lock_until__';
    const IDLE_MS = 30*60*1000; // 30 åˆ†é˜è‡ªå‹•ç™»å‡º

    const $ = s => document.querySelector(s);
    const shield = $('#shield'), gate = $('#gate'), app = $('#app');
    const pwd = $('#pwd'), btnLogin = $('#btnLogin'), btnClear = $('#btnClear'), err = $('#err');

    // ååµŒå…¥
    if (window.top !== window.self){
      try{ window.top.location = window.self.location.href; }catch(_){}
    }

    // DevToolsï¼å¯è¦–ç‹€æ…‹åµæ¸¬
    let _devWarned=false;
    function devtoolsSuspect(){ if(_devWarned) return; shield && (shield.style.display='flex'); _devWarned=true; }
    setInterval(()=>{
      if (Math.abs(window.outerWidth-window.innerWidth)>160 || Math.abs(window.outerHeight-window.innerHeight)>160) devtoolsSuspect();
    }, 800);
    (function tick(t0){ const now=performance.now(); if(now-t0>200) devtoolsSuspect(); requestAnimationFrame(()=>tick(performance.now())); })(performance.now());
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) shield && (shield.style.display='flex'); });

    // â€œæ“‹æ–°æ‰‹â€åš‡é˜»
    window.addEventListener('contextmenu', e=>{ e.preventDefault(); showShield(); }, {capture:true});
    window.addEventListener('copy', e=>e.preventDefault(), {capture:true});
    window.addEventListener('cut',  e=>e.preventDefault(), {capture:true});
    window.addEventListener('selectstart', e=>e.preventDefault(), {capture:true});
    window.addEventListener('keydown', (e)=>{
      const K=(e.key||'').toUpperCase();
      if(e.key==='F12'){ e.preventDefault(); showShield(); }
      if(e.ctrlKey && ['U','S','P'].includes(K)){ e.preventDefault(); showShield(); }
      if(e.ctrlKey && e.shiftKey && ['I','J','C','K'].includes(K)){ e.preventDefault(); showShield(); }
    }, {capture:true});
    function showShield(){ shield.style.display='flex'; }

    // ç™»å…¥/é–å®šæ§åˆ¶
    function isLocked(){ const until=+(sessionStorage.getItem(LOCK_UNTIL_KEY)||0); return Date.now()<until; }
    function remainingLockSec(){ const until=+(sessionStorage.getItem(LOCK_UNTIL_KEY)||0); return Math.max(0, Math.ceil((until-Date.now())/1000)); }
    function setLock(seconds){ sessionStorage.setItem(LOCK_UNTIL_KEY, String(Date.now()+seconds*1000)); }
    function addFailAndMaybeLock(){
      const n=(+(sessionStorage.getItem(FAIL_KEY)||0))+1;
      sessionStorage.setItem(FAIL_KEY,String(n));
      if(n>=5){ const minutes=Math.min(60, Math.pow(2, n-5)); setLock(minutes*60); }
    }
    function resetFails(){ sessionStorage.removeItem(FAIL_KEY); sessionStorage.removeItem(LOCK_UNTIL_KEY); }
    let idleTimer=null;
    function startIdleLogout(){
      const kick=()=>{ sessionStorage.removeItem(KEY_OK); location.reload(); };
      const bump=()=>{ clearTimeout(idleTimer); idleTimer=setTimeout(kick, IDLE_MS); };
      ['click','keydown','mousemove','touchstart','scroll','visibilitychange'].forEach(ev=>document.addEventListener(ev, bump, {passive:true}));
      bump();
    }

    async function sha256Hex(t){
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(t));
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    async function enter(){
      err.style.display='none';
      if(isLocked()){ err.textContent=`å˜—è©¦æ¬¡æ•¸éå¤šï¼Œè«‹ ${remainingLockSec()} ç§’å¾Œå†è©¦ã€‚`; err.style.display=''; return; }

      const v=(pwd.value||'').trim();
      if(!v){ err.textContent='è«‹è¼¸å…¥å¯†ç¢¼ / Please enter password.'; err.style.display=''; return; }

      const before=Date.now();
      const h=await sha256Hex(v);
      if(h===PASS_HASH){
        sessionStorage.setItem(KEY_OK,'1');
        resetFails();
        gate.classList.add('hidden'); app.classList.remove('hidden');
        startIdleLogout();
        loadDepsAndRun();
      }else{
        // éš¨æ©Ÿå»¶é²ï¼ˆ1~1.6ç§’ï¼‰é™ä½æš´åŠ›å˜—è©¦æ•ˆç‡
        const delay = 1000 + Math.random()*600 - (Date.now()-before);
        if(delay>0) await new Promise(r=>setTimeout(r, delay));
        addFailAndMaybeLock();
        err.textContent='å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚/ Incorrect password.'; err.style.display='';
      }
    }
    btnLogin.addEventListener('click', enter);
    btnClear.addEventListener('click', ()=>{ pwd.value=''; err.style.display='none'; resetFails(); sessionStorage.removeItem(KEY_OK); pwd.focus(); });
    pwd.addEventListener('keydown', e=>{ if(e.key==='Enter') enter(); });

    (function boot(){
      if(sessionStorage.getItem(KEY_OK)==='1'){ gate.classList.add('hidden'); app.classList.remove('hidden'); startIdleLogout(); loadDepsAndRun(); }
    })();

    function loadScript(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=()=>rej(new Error('load fail: '+src)); document.body.appendChild(s); }); }
    async function loadDepsAndRun(){
      await loadScript('https://unpkg.com/@supabase/supabase-js@2');
      await loadScript('shared.js?v=txfee45tax2');

      (async function(){
        const SUPABASE_URL = "https://byhbmmnacezzgkwfkozs.supabase.co";
        const SUPABASE_ANON_KEY = "sb_publishable_xVe8fGbqQ0XGwi4DsmjPMg_Y2RBOD3t";
        const BUCKET = "reports";
        const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { global:{ fetch:(u,o={})=>fetch(u,{...o,cache:'no-store'}) } });

        const WANT = { "0807": /0807/i, "1001": /1001/i, "00909": /00909/i, "1031": /1031/i };
        const pubUrl = (path) => sb.storage.from(BUCKET).getPublicUrl(path).data.publicUrl;

        async function listDir(prefix){
          const p = (prefix && !prefix.endsWith('/')) ? prefix + '/' : (prefix || '');
          const { data } = await sb.storage.from(BUCKET).list(p, { limit:1000, sortBy:{ column:'name', order:'asc' }});
          return (data || []).map(it => ({ ...it, fullPath: p + it.name }));
        }
        async function listDeepN(prefix, depth, maxDepth, out){
          if(depth>maxDepth) return;
          const entries = await listDir(prefix);
          for(const it of entries){
            if(it.id === null){ await listDeepN(it.fullPath, depth+1, maxDepth, out); }
            else{ out.push(it); }
          }
        }
        async function latestFileDeep(regex){
          const all=[]; await listDeepN('', 0, 2, all);
          const files = all.filter(it => it.id !== null && regex.test(it.name));
          if (!files.length) return null;
          const scoreInName = n => { const m = (n||'').match(/\b(20\d{6})\b/g); return m ? Math.max(...m.map(s=>+s)) : 0; };
          files.sort((a,b)=>{
            const sa=scoreInName(a.name), sb=scoreInName(b.name);
            if(sa!==sb) return sb-sa;
            const ta=a.updated_at? Date.parse(a.updated_at):0, tb=b.updated_at? Date.parse(b.updated_at):0;
            if(ta!==tb) return tb-ta;
            return (b.metadata?.size||0)-(a.metadata?.size||0);
          });
          return files[0];
        }
        async function readManifest(name){
          try{ const { data } = await sb.storage.from(BUCKET).download(`manifests/${name}.json`); if(!data) return null; return JSON.parse(await data.text()); }
          catch{ return null; }
        }

        // ===== è§£æå™¨å‡ç´šï¼šæ”¯æ´ Canon + CSV =====
        const CANON_RE=/^(\d{14})\.0{6}\s+(\d+\.\d{6})\s+(æ–°è²·|å¹³è³£|æ–°è³£|å¹³è²·|å¼·åˆ¶å¹³å€‰)\s*$/;

        // å…è¨±æ›´å¤šå‹•ä½œåˆ¥åï¼šè²·é€²/åŠ ç¢¼/å†åŠ ç¢¼/åŠ ç¢¼æ”¤å¹³ â†’ æ–°è²·ï¼›è³£å‡º â†’ å¹³è³£ï¼›å¼·å¹³ â†’ å¼·åˆ¶å¹³å€‰
        const EXTRACT_RE=/.*?(\d{14})(?:\.0{1,6})?\s+(\d+(?:\.\d{1,6})?)\s*(æ–°è²·|å¹³è³£|æ–°è³£|å¹³è²·|å¼·åˆ¶å¹³å€‰|å¼·å¹³|è²·é€²|è³£å‡º|åŠ ç¢¼|å†åŠ ç¢¼|åŠ ç¢¼æ”¤å¹³)\s*$/;

        function mapAction(act){
          if(act==='å¼·å¹³') return 'å¼·åˆ¶å¹³å€‰';
          if(/^(è²·é€²|åŠ ç¢¼|å†åŠ ç¢¼|åŠ ç¢¼æ”¤å¹³)$/.test(act)) return 'æ–°è²·';
          if(act==='è³£å‡º') return 'å¹³è³£';
          return act;
        }

        function normalizeText(raw){
          let s=raw.replace(/\ufeff/gi,'').replace(/\u200b|\u200c|\u200d/gi,'');
          s=s.replace(/[\x00-\x09\x0B-\x1F\x7F]/g,'').replace(/\r\n?/g,'\n').replace(/\u3000/g,' ');
          return s.split('\n').map(l=>l.replace(/\s+/g,' ').trim()).filter(Boolean).join('\n');
        }

        // å°‡ 5/6 ä½æ™‚é–“è£œé›¶ç‚º 6 ä½
        function padTime6(t){
          t = String(t||'').trim();
          return t.padStart(6,'0').slice(0,6);
        }

        // å˜—è©¦ï¼šå…ˆæŠ“ Canon é¢¨æ ¼ï¼›ä¸è¡Œå†æŠ“ CSVï¼ˆæ—¥æœŸ,æ™‚é–“,åƒ¹æ ¼,å‹•ä½œ,èªªæ˜ï¼‰
        function canonicalize(txt){
          const out=[]; let ok=0;
          const lines = txt.split('\n');

          for(const l of lines){
            // A) ç›´æ¥æœ‰ 14 ç¢¼æ™‚é–“æˆ³ï¼ˆèˆŠæ¨™æº–è¡Œæˆ–æ··é›œè¡Œï¼‰
            let m=l.match(EXTRACT_RE);
            if(m){
              const ts=m[1], px=Number(m[2]);
              const p6 = Number.isFinite(px)?px.toFixed(6):m[2];
              const act = mapAction(m[3]);
              out.push(`${ts}.000000 ${p6} ${act}`); ok++; continue;
            }
            // B) CSVï¼šæ—¥æœŸ,æ™‚é–“,åƒ¹æ ¼,å‹•ä½œ,èªªæ˜...
            if(l.includes(',')){
              const parts=l.split(',').map(x=>x.trim());
              if(parts.length>=4){
                const d8=parts[0];               // YYYYMMDD
                const t = padTime6(parts[1]);    // HHMMSS (è£œ0)
                const px = Number(parts[2]);     // åƒ¹æ ¼
                const act0 = parts[3];           // å‹•ä½œ
                if(/^\d{8}$/.test(d8) && /^\d{6}$/.test(t) && Number.isFinite(px)){
                  const act = mapAction(act0);
                  out.push(`${d8}${t}.000000 ${px.toFixed(6)} ${act}`); ok++; continue;
                }
              }
            }
          }
          return { canon: out.join('\n'), ok };
        }

        async function fetchSmart(url){
          const res=await fetch(url,{cache:'no-store'}); if(!res.ok) throw new Error(`${res.status} ${res.statusText}`);
          const buf=await res.arrayBuffer();
          for(const enc of ['utf-8','big5','utf-16le','utf-16be']){
            try{
              const td=new TextDecoder(enc);
              const norm=normalizeText(td.decode(buf));
              const {canon,ok}=canonicalize(norm);
              if(ok>0) return {canon,ok};
            }catch{}
          }
          const td=new TextDecoder('utf-8');
          const norm=normalizeText(td.decode(buf));
          const {canon,ok}=canonicalize(norm);
          return {canon,ok};
        }

        function parseCanon(text){
          const rows=[]; if(!text) return rows;
          for(const line of text.split('\n')){
            const m=line.match(CANON_RE);
            if(m) rows.push({ts:m[1], line});
          }
          rows.sort((a,b)=>a.ts.localeCompare(b.ts));
          return rows;
        }

        function mergeByBaseline(baseText, latestText){
          const A=parseCanon(baseText), B=parseCanon(latestText);
          const baseMin=A.length?A[0].ts.slice(0,8):(B.length?B[0].ts.slice(0,8):'');
          const baseMax=A.length?A[A.length-1].ts:'';
          const added=baseMax?B.filter(x=>x.ts>baseMax).map(x=>x.line):B.map(x=>x.line);
          const mergedLines=[...A.map(x=>x.line), ...added];
          const endDay=mergedLines.length?mergedLines[mergedLines.length-1].match(CANON_RE)[1].slice(0,8):baseMin;
          return { combined:mergedLines.join('\n'), start8:baseMin, end8:endDay };
        }

        function dailySeriesFromMerged(mergedTxt){
          const parsed=window.SHARED.parseTXT(mergedTxt);
          const report=window.SHARED.buildReport(parsed.rows);
          const m=new Map();
          for(const t of report.trades){
            const d=String(t.tsOut).slice(0,8);
            m.set(d,(m.get(d)||0)+t.gainSlip);
          }
          const days=[...m.keys()].sort();
          const vals=days.map(d=>m.get(d));
          return {days, vals};
        }

        const d8=s=> new Date(`${s.slice(0,4)}-${s.slice(4,6)}-${s.slice(6,8)}T00:00:00`);
        const fmtD8=s=> `${s.slice(0,4)}/${s.slice(4,6)}/${s.slice(6,8)}`;
        function simpleReturnWithRange(days, vals, winDays){
          if(!days.length) return {ret:null, range:'---'};
          const end=days[days.length-1];
          const thr=new Date(d8(end).getTime()-(winDays-1)*86400000);
          let i=0; while(i<days.length && d8(days[i])<thr) i++;
          if(i>=days.length) return {ret:null, range:'---'};
          const startDay=days[i];
          const pref=[0]; for(const v of vals) pref.push(pref[pref.length-1]+v);
          const sum=pref[vals.length]-pref[i];
          return { ret:sum/1_000_000, range:`${fmtD8(startDay)} - ${fmtD8(end)}` };
        }
        function simpleReturnYearWindowWithRange(days, vals, winDays){
          if(!days.length) return {ret:null, range:'---'};
          const first=days[0], last=days[days.length-1];
          const cover=Math.max(1, Math.round((d8(last)-d8(first))/86400000)+1);
          if(cover < winDays-60) return {ret:null, range:'---'};
          const end=last; const thr=new Date(d8(end).getTime()-(winDays-1)*86400000);
          let i=0; while(i<days.length && d8(days[i])<thr) i++; if(i>=days.length) i=0;
          const startDay=days[i];
          const pref=[0]; for(const v of vals) pref.push(pref[pref.length-1]+v);
          const sum=pref[vals.length]-pref[i];
          return { ret:sum/1_000_000, range:`${fmtD8(startDay)} - ${fmtD8(end)}` };
        }
        const setVal=(id,v)=>{ const el=document.getElementById(id); if(!el) return; el.classList.remove('pos','neg','neu'); if(v==null){ el.textContent='---'; el.classList.add('neu'); return; } el.textContent=(v*100).toFixed(2)+'%'; el.classList.add(v>0?'pos':(v<0?'neg':'neu')); };
        const setText=(id,text)=>{ const el=document.getElementById(id); if(el) el.textContent=text||'---'; };

        async function fillCard(key){
          const set=(suf,v)=>setVal(`${suf}-${key}`,v);
          const setR=(suf,r)=>setText(`${suf}-range-${key}`,r);
          const setPeriod=text=>{ const el=document.getElementById(`period-${key}`); if(el) el.textContent=text; };
          try{
            const latest=await latestFileDeep(WANT[key]);
            if(!latest){ ['wk1','wk2','m1','m2','m3','m6','y1','y2','y3','y6'].forEach(x=>{ set(x,null); setR(x,'---'); }); setPeriod('â€”'); return; }
            const latestText=(await fetchSmart(pubUrl(latest.fullPath))).canon;
            const manifest=await readManifest(key);
            let merged=latestText, start8='', end8='';
            if(manifest?.baseline_path){
              const baseText=(await fetchSmart(pubUrl(manifest.baseline_path))).canon;
              const m=mergeByBaseline(baseText, latestText);
              merged=m.combined; start8=m.start8; end8=m.end8;
            }else{
              const rows=parseCanon(latestText);
              start8=rows.length?rows[0].ts.slice(0,8):''; end8=rows.length?rows[rows.length-1].ts.slice(0,8):'';
            }
            const {days, vals}=dailySeriesFromMerged(merged);
            const W1=simpleReturnWithRange(days, vals, 7),  W2=simpleReturnWithRange(days, vals, 14);
            const M1=simpleReturnWithRange(days, vals, 30), M2=simpleReturnWithRange(days, vals, 60);
            const M3=simpleReturnWithRange(days, vals, 90), M6=simpleReturnWithRange(days, vals, 180);
            const Y1=simpleReturnYearWindowWithRange(days, vals, 365), Y2=simpleReturnYearWindowWithRange(days, vals, 730), Y3=simpleReturnYearWindowWithRange(days, vals, 1095), Y6=simpleReturnYearWindowWithRange(days, vals, 2190);
            set('wk1',W1.ret); setR('wk1',W1.range);
            set('wk2',W2.ret); setR('wk2',W2.range);
            set('m1',M1.ret);  setR('m1',M1.range);
            set('m2',M2.ret);  setR('m2',M2.range);
            set('m3',M3.ret);  setR('m3',M3.range);
            set('m6',M6.ret);  setR('m6',M6.range);
            set('y1',Y1.ret);  setR('y1',Y1.range);
            set('y2',Y2.ret);  setR('y2',Y2.range);
            set('y3',Y3.ret);  setR('y3',Y3.range);
            set('y6',Y6.ret);  setR('y6',Y6.range);
            setPeriod(`${start8||'â€”'} - ${end8||'â€”'}`);
          }catch(e){
            ['wk1','wk2','m1','m2','m3','m6','y1','y2','y3','y6'].forEach(x=>{ set(x,null); setR(x,'---'); }); setPeriod('â€”');
          }
        }
        await Promise.all([fillCard("0807"), fillCard("1001"), fillCard("00909"), fillCard("1031")]);
      })();
    }
  })();
  </script>
</body>
</html>

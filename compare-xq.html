<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>compare-xq｜XQ 回測匯出 → TXT（交易列）／對帳</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#121826; --muted:#98a2b3; --text:#e6edf3;
      --line:#263042; --accent:#5eead4; --danger:#fb7185;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
    }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:var(--sans); }
    .wrap{ max-width:1100px; margin:0 auto; padding:24px 16px 56px; }
    h1{ font-size:20px; margin:0 0 8px; }
    .sub{ color:var(--muted); font-size:13px; margin:0 0 18px; line-height:1.5; }
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media(min-width:980px){ .grid{ grid-template-columns: 1fr 1fr; } }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px; }
    .card h2{ font-size:14px; margin:0 0 10px; color:#cbd5e1; }
    .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    label{ font-size:12px; color:var(--muted); display:block; margin:8px 0 6px; }
    input[type="file"], input[type="text"], select{
      width:100%; box-sizing:border-box;
      background:#0f172a; border:1px solid var(--line); color:var(--text);
      padding:10px; border-radius:10px; outline:none;
    }
    .ctrl2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    button{
      background:#0f172a; border:1px solid var(--line); color:var(--text);
      padding:10px 12px; border-radius:10px; cursor:pointer;
    }
    button.primary{ border-color:#1f4f4a; background:rgba(94,234,212,0.08); }
    button:disabled{ opacity:.45; cursor:not-allowed; }
    .pill{ display:inline-block; padding:4px 10px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:var(--muted); }
    .pill.ok{ border-color:#1f4f4a; color:var(--accent); }
    .pill.bad{ border-color:#3b1f2a; color:var(--danger); }
    .mono{ font-family:var(--mono); }
    pre{
      background:#0f172a; border:1px solid var(--line);
      border-radius:12px; padding:12px; overflow:auto; max-height:360px;
      margin:10px 0 0;
      font-family:var(--mono); font-size:12px; line-height:1.45;
    }
    table{ width:100%; border-collapse:collapse; font-size:12px; }
    th, td{ border-bottom:1px solid var(--line); padding:8px 6px; text-align:left; }
    th{ color:#cbd5e1; font-weight:600; position:sticky; top:0; background:var(--card); }
    .scroll{ overflow:auto; max-height:420px; border:1px solid var(--line); border-radius:12px; }
    .hint{ font-size:12px; color:var(--muted); line-height:1.5; }
    a{ color:var(--accent); text-decoration:none; }
    .footer{ color:var(--muted); font-size:12px; margin-top:16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>compare-xq｜XQ 回測匯出 → TXT（交易列）／對帳</h1>
    <p class="sub">
      XQ 匯出沒有 INPOS，所以本頁將 XQ「交易分析」明細轉成 TXT 只含交易列（新買/平賣/新賣/平買/強制平倉）。
      你自己的 TXT 若含 INPOS，對帳時會自動忽略。
    </p>

    <div class="grid">
      <div class="card">
        <h2>① 匯入 XQ 回測匯出檔（檔案2）</h2>

        <label>選擇檔案（.xlsx / .csv）</label>
        <input id="xqFile" type="file" accept=".xlsx,.csv,.txt" />

        <div class="ctrl2">
          <div>
            <label>時間格式</label>
            <select id="tsMode">
              <option value="14">YYYYMMDDhhmmss（預設，符合你目前 TXT）</option>
              <option value="canon">YYYYMMDDhhmmss.000000（Canon）</option>
            </select>
          </div>
          <div>
            <label>價格格式</label>
            <select id="pxMode">
              <option value="raw">原樣（預設：整數就整數）</option>
              <option value="fixed6">固定 6 位小數</option>
            </select>
          </div>
        </div>

        <label>輸出檔名（預設：xq-export.txt）</label>
        <input id="outName" type="text" value="xq-export.txt" />

        <div class="row" style="margin-top:10px;">
          <button id="btnConvert" class="primary" disabled>轉成 TXT</button>
          <a id="dlCanon" href="#" download style="display:none;">下載 TXT</a>
          <span id="xqStatus" class="pill">尚未載入</span>
        </div>

        <div class="hint" style="margin-top:10px;">
          解析欄位：<span class="mono">進場時間/方向/價格</span>、<span class="mono">出場時間/方向/價格</span>，每筆轉成兩行交易列。
        </div>

        <pre id="canonPreview" class="mono" style="display:none;"></pre>
      </div>

      <div class="card">
        <h2>② 匯入你的 TXT（檔案1）做對帳（可選）</h2>

        <label>選擇策略 TXT（可含參數列與 INPOS 行；會自動忽略）</label>
        <input id="canonFile" type="file" accept=".txt,.csv" />

        <div class="row" style="margin-top:10px;">
          <button id="btnCompare" disabled>對帳比較</button>
          <span id="cmpStatus" class="pill">尚未比較</span>
        </div>

        <div class="hint" style="margin-top:10px;">
          對帳：只比較交易動作 <span class="mono">新買、平賣、新賣、平買、強制平倉</span>，忽略 INPOS 與參數列。
        </div>

        <pre id="cmpResult" class="mono" style="display:none;"></pre>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <h2>③ 事件預覽（解析後）</h2>
      <div class="scroll">
        <table id="tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>時間</th>
              <th>價格</th>
              <th>動作</th>
              <th>來源</th>
            </tr>
          </thead>
          <tbody id="tblBody">
            <tr><td colspan="5" class="hint">尚未載入資料</td></tr>
          </tbody>
        </table>
      </div>
      <div class="footer">
        之後你要我接到 index.html 時，我會加一張卡片連到 <span class="mono">compare-xq.html</span>。
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="./compare-xq.js"></script>
</body>
</html>
